<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="referrer" content="no-referrer">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cloud TV</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
html,body{
    margin:0;
    width:100%;
    height:100%;
    background:#000;
    overflow:hidden;
    font-family:Arial,Helvetica,sans-serif;
}

/* ===== PLAYER ===== */
#player-wrapper{
    position:fixed;
    inset:0;
    background:#000;
}

/* iframe */
#stream-iframe{
    width:100%;
    height:100%;
    border:none;
    background:#000;
}

/* ===== LOADER ===== */
#loader{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#000;
    z-index:5;
}

.loader{
    width:45px;
    height:45px;
    border:5px solid #333;
    border-top:5px solid #fff;
    border-radius:50%;
    animation:spin 1s linear infinite;
}

@keyframes spin{
    to{transform:rotate(360deg)}
}

/* ===== CONTROLS ===== */
#controls{
    position:absolute;
    bottom:0;
    left:0;
    right:0;
    padding:12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:linear-gradient(to top,rgba(0,0,0,.9),rgba(0,0,0,.2));
    transition:.4s;
    z-index:10;
}

.controls-left button,
.controls-right button{
    background:none;
    border:none;
    color:#fff;
    font-size:18px;
    padding:10px 14px;
    border-radius:8px;
    transition:.3s;
}

.controls-left button:hover,
.controls-right button:hover{
    background:rgba(255,255,255,.15);
}

.hidden{
    opacity:0;
    pointer-events:none;
}

/* Mobile */
@media(max-width:768px){
    .controls-left button,
    .controls-right button{
        font-size:16px;
        padding:8px 10px;
    }
}
</style>
</head>

<body>

<div id="player-wrapper">

    <!-- Loader -->
    <div id="loader">
        <div class="loader"></div>
    </div>

    <!-- Stream -->
    <iframe id="stream-iframe"
        allow="autoplay; encrypted-media; picture-in-picture"
        allowfullscreen
        loading="lazy"></iframe>

    <!-- Controls -->
    <div id="controls">
        <div class="controls-left">
            <button onclick="reloadStream()"><i class="fas fa-rotate"></i></button>
            <button onclick="toggleMute()" id="muteBtn"><i class="fas fa-volume-up"></i></button>
        </div>

        <div class="controls-right">
            <button onclick="toggleFullscreen()"><i class="fas fa-expand"></i></button>
            <button onclick="goBack()"><i class="fas fa-times"></i></button>
        </div>
    </div>

</div>

<script>
let hideTimer;
let muted=false;
let streamURL="";

/* ===== FETCH STREAM ===== */
document.addEventListener('DOMContentLoaded',()=>{
    const params=new URLSearchParams(location.search);
    const streamId=params.get("id");
    if(!streamId) return;

    fetch("https://raw.githubusercontent.com/Shubhamkur/Tv/refs/heads/main/tv")
    .then(res=>res.json())
    .then(data=>{
        const stream=data.find(i=>i.id===streamId);
        if(!stream) return;

        if(stream.mpd && stream.key){
            const mpd=encodeURIComponent(stream.mpd);
            const [key1,key2]=stream.key.split(":");
            streamURL = `./drm-player.html?mpd=${mpd}&keyId=${key1}&key=${key2}`;
        }else if(stream.m3u8){
            streamURL=stream.m3u8;
        }

        loadStream();
    });
});

/* ===== LOAD STREAM ===== */
function loadStream(){
    const iframe=document.getElementById("stream-iframe");
    iframe.src=streamURL;
    iframe.onload=()=>document.getElementById("loader").style.display="none";
}

/* ===== CONTROLS ===== */
function reloadStream(){
    document.getElementById("loader").style.display="flex";
    loadStream();
}

function toggleMute(){
    muted=!muted;
    document.getElementById("muteBtn").innerHTML=
        muted?'<i class="fas fa-volume-mute"></i>':'<i class="fas fa-volume-up"></i>';
}

function toggleFullscreen(){
    const el=document.getElementById("player-wrapper");
    if(!document.fullscreenElement) el.requestFullscreen();
    else document.exitFullscreen();
}

function goBack(){
    history.back();
}

/* ===== AUTO HIDE CONTROLS ===== */
document.addEventListener("mousemove",showControls);
document.addEventListener("touchstart",showControls);

function showControls(){
    const c=document.getElementById("controls");
    c.classList.remove("hidden");
    clearTimeout(hideTimer);
    hideTimer=setTimeout(()=>c.classList.add("hidden"),3000);
}
</script>

</body>
</html>
